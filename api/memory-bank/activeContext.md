# Active Context - API Module

> **最終更新**: 2026/02/10  
> **親プロジェクトコンテキスト**: `/workspace/memory-bank/activeContext.md` を参照

## 現在の状態

### プロジェクトステータス
- **フェーズ**: 本番運用中、継続的改善
- **バージョン**: API_VERSION（settings.pyで管理）
- **安定性**: 安定稼働中

### 最近の主要変更
1. **テーブル名変更** (2025/08/30)
   - マイグレーション: `20250830_180124_568d3abf1cee_change_table_name.py`
   - データベーススキーマの整理

2. **お気に入り機能追加** (2024/01/05)
   - マイグレーション: `20240105_073810_43b53bf68b39_add_is_favorite.py`
   - ユーザーが書籍をお気に入り登録可能

3. **重複検出機能** (2023/09/29-30)
   - aHashによる画像ハッシュ
   - 重複テーブル追加
   - on_delete修正

## 現在の作業フォーカス

### Memory Bank初期化（進行中）
- APIディレクトリ専用のmemory-bank構築
- 親ディレクトリ（`/workspace/memory-bank/`）との連携
- ドキュメント整備

### 次のステップ
1. Memory Bankドキュメント完成
2. .clinerules更新（親ディレクトリ参照記載）
3. 既存コードの棚卸し
4. 改善点の洗い出し

## アクティブな技術的課題

### 既知の問題
1. **ファイル名長制限**
   - 症状: `OSError: [Errno 36] File name too long`
   - 発生箇所: Zip展開時（`mixins/convertor.py`）
   - 現状対応: エラーキャッチ
   - 要対応: パス短縮ロジック

2. **タイポの継続使用**
   - `authenticaitonSuccessful` / `authenticaitonFail`
   - 全体で使用されているため変更困難
   - 方針: 現状維持（互換性優先）

### パフォーマンス最適化候補
- [ ] N+1クエリ問題の調査
- [ ] キャッシュ戦略の見直し
- [ ] 大量データ処理の最適化

## アーキテクチャ決定事項（直近）

### バックグラウンドワーカー
- 現状: `worker.py`のポーリング方式
- 検討: Celery移行？
- 判断保留: 現状で問題なし

### データベースマイグレーション
- Alembic継続使用
- 自動生成 + 手動レビュー方針

## 開発環境の状態

### 現在の設定
- Python 3.11+
- FastAPI 0.116.1
- SQLAlchemy 2.0.43
- PostgreSQL 16

### 依存関係の健全性
- 最終更新確認: 要実施
- セキュリティアラート: 未確認

## Vue 3フロントエンドとの統合

### API型定義の同期
- フロントエンド: `vue/src/api.d.ts`
- 生成元: `/api/openapi.json`
- 同期方法: 手動実行（自動化検討中）

### 認証フロー
- JWT + Cookie方式
- フロントエンド: `stores/userData.ts`
- バックエンド: `users/router.py`

## 今後の展望

### 短期（1-2ヶ月）
- [ ] Memory Bank完全整備
- [ ] 既存コードのリファクタリング候補抽出
- [ ] テストカバレッジ向上
- [ ] ドキュメント整備

### 中期（3-6ヶ月）
- [ ] パフォーマンス改善
- [ ] エラーハンドリング強化
- [ ] ロギング改善
- [ ] 監視・アラート整備

### 長期（6ヶ月以上）
- [ ] Redis導入検討
- [ ] Celery導入検討
- [ ] GraphQL検討
- [ ] マイクロサービス化検討

## チーム・コミュニケーション

### 主要ステークホルダー
- フロントエンド開発者（Vue 3）
- システム管理者
- エンドユーザー

### ドキュメント
- OpenAPI仕様: `/api`
- README.md: 開発者向け
- Memory Bank: Cline向け

## 注意事項

### 変更時の必須対応
1. データベーススキーマ変更 → Alembicマイグレーション作成
2. API仕様変更 → フロントエンド型定義再生成
3. 認証ロジック変更 → フロントエンドとの調整
4. ログメッセージ → 日本語で記述

### コーディング規約
- ログは日本語
- Gitコミットメッセージは日本語
- コメントは日本語
- 型ヒント必須
- Pydanticスキーマでバリデーション

## 現在のブロッカー
- なし

## 質問・不明点
- なし（初期化段階）
