# Product Context - API Module

> **親プロジェクトコンテキスト**: `/workspace/memory-bank/productContext.md` を参照

## APIが解決する問題

### 1. データ管理の一元化
- Zipファイル内の書籍データへの統一的なアクセス方法を提供
- メタデータの構造化された管理
- リレーショナルデータベースによる効率的なクエリ

### 2. マルチユーザー対応
- 認証・認可による安全なアクセス制御
- ユーザーごとの閲覧履歴・評価・お気に入り管理
- ライブラリの共有機能

### 3. 重い処理の非同期化
- Zipファイルのインポート/エクスポート
- 画像ハッシュ計算（SHA1、aHash）
- サムネイル生成とキャッシング
- 重複チェック処理

### 4. フロントエンドへのデータ提供
- 高速なREST APIによるデータアクセス
- ページネーション対応
- 複雑な検索クエリのサポート
- OpenAPI仕様によるクライアント生成

## ユーザー体験への貢献

### フロントエンド開発者
- OpenAPI仕様による型安全なクライアント生成
- 明確なエンドポイント設計
- Swagger UI（`/api`）での対話的なAPI探索

### エンドユーザー
- 高速な書籍検索（データベースインデックス）
- スムーズな画像表示（キャッシュ機構）
- 安全な認証（JWT + Cookie）
- バックグラウンド処理による応答性の維持

### システム管理者
- Alembicによる管理されたデータベーススキーマ変更
- ログの日本語統一による運用性
- Docker Composeによる簡単なデプロイ

## APIの役割

```
[Vue Frontend] 
    ↓ HTTP/REST
[FastAPI (main.py)]
    ↓
[Router層] → 認証チェック
    ↓
[ビジネスロジック]
    ↓
[SQLAlchemy ORM]
    ↓
[PostgreSQL]

[バックグラウンドワーカー (worker.py)]
    ↓
[Tasks処理] → ファイルシステム操作
    ↓
[データベース更新]
```

## 重要な設計判断

### なぜFastAPI？
- 高速（非同期処理）
- 自動OpenAPI生成
- Pydanticによる型安全性
- Python生態系の活用

### なぜPostgreSQL？
- 複雑なリレーション管理
- 全文検索機能
- トランザクション保証
- 実績ある安定性

### なぜWorkerプロセス？
- 重い処理のAPI応答への影響を回避
- 並列処理によるスループット向上
- タスクキューによる順次実行制御
