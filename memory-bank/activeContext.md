# Active Context

## 現在の作業フォーカス

### メモリーバンク初期化
- **日付**: 2026-02-02
- **作業**: プロジェクトのメモリーバンクドキュメント体系を構築中
- **目的**: Clineがセッション間でプロジェクト状態を完全に理解できるようにする

## 最近の変更

### メモリーバンク構築（2026-02-02）
- `projectbrief.md`: プロジェクトの基本情報、目標、技術スタック定義
- `productContext.md`: プロダクトの存在理由、解決する問題、ユーザーフロー
- `systemPatterns.md`: システムアーキテクチャ、設計パターン、技術的決定
- `techContext.md`: 技術詳細、開発環境、ツール、トラブルシューティング

## 現在のシステム状態

### 実装済みの主要機能
1. **書籍管理システム**
   - Zipファイルのインポート・エクスポート
   - メタデータ管理（タイトル、著者、タグ等）
   - ライブラリ管理
   - ハッシュベースの重複検出

2. **認証システム**
   - JWT認証
   - ユーザー管理
   - ライブラリ共有機能

3. **バックグラウンド処理**
   - タスクキューシステム
   - マルチプロセスワーカー
   - 自動インポート監視

4. **フロントエンド（Vue 2）**
   - 書籍一覧・詳細表示
   - 検索・フィルタリング
   - ユーザー設定管理

### 開発中の機能
1. **Vue 3への移行**
   - nuxt/ディレクトリ: Nuxt 3ベース実装中
   - vue/ディレクトリ: Vue 3 + Viteベース実装中
   - 現状: 本番環境はVue 2 (web/)を使用

### 既知の課題
1. ファイル名が長すぎる場合のエラー（OSError: [Errno 36]）
2. Vue 2からVue 3への移行が未完了
3. CI/CDパイプラインが未構築

## アクティブな決定と考慮事項

### 1. フロントエンド移行戦略
**現状**: Vue 2（web/）が本番稼働中
**検討事項**: 
- Nuxt 3 vs Vue 3 + Vite、どちらを採用するか
- 段階的な移行 vs 一斉移行
- Vuetify 2 → 3の移行コスト

**優先度**: 中（動作中だが将来的に必須）

### 2. タスクキューの改善
**現状**: データベースベースのシンプルなキュー
**検討事項**:
- Redis + Celeryへの移行の必要性
- 現状で十分か？
- パフォーマンス要件の変化

**優先度**: 低（現状問題なし）

### 3. モニタリング・オブザーバビリティ
**現状**: ログのみ
**検討事項**:
- Prometheus + Grafana導入
- アプリケーションメトリクス収集
- エラートラッキング（Sentry等）

**優先度**: 低（小規模運用では不要）

## 次のステップ候補

### 短期（1-2週間）
1. メモリーバンクドキュメントの完成
2. 既存機能のバグフィックス
3. ドキュメント整備（README更新等）

### 中期（1-3ヶ月）
1. Vue 3への移行完了
2. テストカバレッジ向上
3. パフォーマンス最適化

### 長期（3ヶ月以上）
1. 外部メタデータソース連携拡張
2. レコメンデーション機能
3. モバイルアプリ検討

## 作業時の重要な注意事項

### 開発ワークフロー
1. **ファイル変更後は必ずDocker再ビルド・起動確認**
   ```bash
   docker compose down
   docker compose build
   docker compose up -d
   docker ps
   docker logs -f [service]
   ```

2. **ログは日本語で統一**
   - コミットメッセージ: 日本語
   - プログラム内コメント: 日本語
   - ログメッセージ: 日本語

3. **APIログは`mixins/log.py`の`setup_logger`を使用**

4. **Workerログの特殊ルール**
   - 対象不存在でスキップする場合はログ出力しない

### データベース変更時
1. Alembicマイグレーションファイル作成
2. テスト環境で動作確認
3. 本番適用前にバックアップ

### コードレビューポイント
1. ログメッセージは適切か？
2. エラーハンドリングは適切か？
3. パフォーマンスへの影響は？
4. セキュリティリスクはないか？

## 依存関係・ブロッカー

### 外部依存
- PostgreSQL 16の安定性に依存
- Dockerの正常動作に依存
- Python 3.11+の互換性に依存

### 技術的負債
1. Vue 2のサポート期限切れ（2023年12月末）→ 移行必要
2. 一部の古いnpmパッケージ（axios 0.21.4等）→ 更新検討
3. テストカバレッジが低い

## コラボレーション情報

### 主要な開発パス
- バックエンド変更: `api/` → Dockerビルド → テスト
- フロントエンド変更: `web/` → ビルド → Dockerビルド → テスト
- データベース変更: モデル修正 → Alembicマイグレーション → 適用

### デバッグ時のチェックポイント
1. Docker Composeログを確認
2. PostgreSQLの接続状態確認
3. Nginx設定とプロキシ動作確認
4. ブラウザのコンソールログ確認
5. APIドキュメント（/api）で手動テスト

## 環境固有の注意事項

### 開発環境（VS Code Codespace）
- 現在の作業ディレクトリ: `/workspaces/hinagiku-viewer`
- Dockerが利用可能
- Node.js、Python、その他ツールがプリインストール済み

### ポート使用状況
- 80: Nginx（外部公開）
- 8000: FastAPI（内部のみ）
- 5432: PostgreSQL（内部のみ）
- 8080: フロントエンド開発サーバー（ローカル開発時）

## 最近の学習・発見

### プロジェクト構造の理解
- 3つのフロントエンド実装（web/, nuxt/, vue/）が存在
- web/が現在の本番環境
- 他2つは次世代への移行実験

### アーキテクチャの特徴
- 単一ポート公開（Nginxでプロキシ統合）
- タスクキューはシンプルなDBベース
- Eager Loadingでパフォーマンス優先
- ログは日本語統一

### コーディング規約
- Gitコミット: 日本語
- コメント: 日本語
- ログ: 日本語
- API設計: RESTful原則
- スキーマ: Pydantic V2使用
