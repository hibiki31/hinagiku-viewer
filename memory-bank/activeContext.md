# Active Context

## 現在の作業フォーカス

### Vue 3フロントエンド（vue/）の開発
- **日付**: 2026-02-08
- **方針決定**: `vue/`（Vue 3 + Vite）が主力フロントエンドとして確定。`nuxt/`は移行実験として残存するが、今後は`vue/`に注力する。
- **現状**: 主要4ページ（書籍一覧、リーダー、ログイン、重複管理）が実装済み。Vue 2（web/）からの機能移植が進行中。

## 最近の変更

### メモリーバンク初期化（2026-02-02）
- `projectbrief.md`: プロジェクトの基本情報、目標、技術スタック定義
- `productContext.md`: プロダクトの存在理由、解決する問題、ユーザーフロー
- `systemPatterns.md`: システムアーキテクチャ、設計パターン、技術的決定
- `techContext.md`: 技術詳細、開発環境、ツール、トラブルシューティング

### ドキュメント整備（2026-02-08）
- `.clinerules`: Vue 3フロントエンド開発パターンの詳細追加、主力フロントエンド方針の明記
- `CLAUDE.md`: Claude Code向けガイドの作成（vue/ディレクトリ内）
- memory-bank全ファイルの見直し・更新

### DevContainer設定（2026-02-02〜）
- Vue 3開発用DevContainerの構築
- Claude Code拡張の導入
- pnpmベースの開発環境

## 現在のシステム状態

### 実装済みの主要機能（バックエンド）
1. **書籍管理システム**: Zipインポート/エクスポート、メタデータ管理、ライブラリ管理、ハッシュ重複検出
2. **認証システム**: JWT認証、ユーザー管理、ライブラリ共有
3. **バックグラウンド処理**: タスクキュー、マルチプロセスワーカー、自動インポート監視
4. **メディア配信**: サムネイル、動的リサイズ、キャッシュ

### Vue 3フロントエンド実装状況
| ページ | 状態 | 備考 |
|--------|------|------|
| 書籍一覧（index.vue） | ✅ 実装済み | 検索・フィルタ・評価・ページネーション・サムネイル/テーブル切替 |
| 書籍リーダー（books/[uuid].vue） | ✅ 実装済み | ページ送り・先読み・見開き表示・評価・設定保存 |
| ログイン（login.vue） | ✅ 実装済み | JWT認証・セットアップダイアログ |
| 重複管理（duplicate.vue） | ✅ 実装済み | 重複検出・削除・一覧表示 |

### Vue 2（web/）にあってVue 3（vue/）に未移植の機能
- ユーザー設定管理の詳細UI
- 管理者機能（ユーザー管理等）
- 一部のメタデータ一括編集機能の完全性
- 外部メタデータ連携UI

## アクティブな決定と考慮事項

### 1. フロントエンド方針（確定）
**決定**: `vue/`（Vue 3 + Vite）を主力フロントエンドとする
**理由**: 
- Nuxt 3のSSR/SSGは本プロジェクトに不要（SPA十分）
- Viteのシンプルな構成が開発効率に寄与
- Vuetify 3との直接統合がスムーズ

### 2. APIクライアント移行
**現状**: AxiosとopenAPIクライアントが共存
**方針**: 
- 新規コードは`openapi-fetch`（`func/client.ts`）を優先
- 型安全性を活用した開発を推進
- 既存のAxios使用箇所は段階的に移行

### 3. バージョン管理の改善
**課題**: `3.0.0`が各ページにハードコードされている
**検討**: package.jsonや環境変数からの動的取得

### 4. 認証メソッド名のタイポ
**現状**: `authenticaitonSuccessful` / `authenticaitonFail`（iとoが逆）
**方針**: 機能に影響しないため、リファクタリング時に修正

## 次のステップ候補

### 短期（1-2週間）
1. Vue 3フロントエンドの残り機能移植
2. openapi-fetchクライアントへの段階的移行
3. 型安全性の向上（any型の排除）
4. バージョン番号の動的取得

### 中期（1-3ヶ月）
1. Vue 3フロントエンドの本番切り替え
2. テストカバレッジ向上（Vitest導入検討）
3. パフォーマンス最適化
4. CI/CDパイプライン構築

### 長期（3ヶ月以上）
1. Vue 2（web/）の廃止
2. 外部メタデータソース連携拡張
3. PWA対応検討
4. レコメンデーション機能

## 作業時の重要な注意事項

### Vue 3フロントエンド開発
1. **ファイルベースルーティング**: `src/pages/`配下に`.vue`ファイルを追加すればルートが自動生成
2. **コンポーネント**: `<script setup lang="ts">` + Composition APIで作成
3. **API型**: `src/api.d.ts`の`components['schemas']`から取得
4. **通知**: `usePushNotice()` composableを使用
5. **自動インポート**: Vue APIとVuetifyは明示的importが不要

### 開発環境
- **作業ディレクトリ**: `/workspaces/hinagiku-viewer/vue`
- **開発サーバー**: `pnpm dev` → http://localhost:3000
- **パッケージマネージャー**: pnpm
- **DevContainer**: Vue 3開発用の設定済み

### コーディング規約
- コミットメッセージ: 日本語
- コメント: 日本語
- ログ: 日本語
- API設計: RESTful原則
- スキーマ: Pydantic V2使用

## 依存関係・ブロッカー

### 外部依存
- PostgreSQL 16の安定性に依存
- Dockerの正常動作に依存
- Python 3.11+の互換性に依存

### 技術的負債
1. Vue 2のサポート期限切れ（2023年12月末）→ vue/への完全移行で解決予定
2. Axiosとopenapi-fetchクライアントの混在 → 段階的にopenapi-fetchへ
3. テストカバレッジが低い
4. バージョン番号のハードコード

## 最終更新日
2026-02-08: コードベース分析に基づく全面更新
