# Product Context

## なぜこのプロジェクトが存在するのか

個人で保有する大量のZipファイル形式の書籍（電子書籍、コミック等）を効率的に管理・閲覧するために開発されました。従来のファイルマネージャーでは以下の課題がありました：

1. メタデータ（タイトル、著者、タグ等）の一元管理が困難
2. 書籍の検索・フィルタリングが不便
3. サムネイルプレビューの生成が手動
4. 重複ファイルの検出が困難
5. 複数デバイスからのアクセスが面倒
6. 閲覧履歴や評価の管理ができない

## 解決する問題

### 1. 書籍の一元管理
**問題**: Zipファイルが散在し、どこに何があるか把握が困難
**解決**: 
- ライブラリ単位での書籍管理
- 自動インポート機能（監視フォルダ）
- サムネイル自動生成による視認性向上

### 2. メタデータの管理
**問題**: ファイル名だけではメタデータ情報が不足
**解決**: 
- タイトル、著者、タグ、ジャンル、出版社、シリーズ等の詳細情報を管理
- マスタデータ管理による一貫性確保
- 多対多リレーションシップによる柔軟な分類

### 3. 重複ファイルの検出
**問題**: 同じ書籍が複数存在しても気づかない
**解決**: 
- SHA1ハッシュによる完全一致検出
- aHash（average hash）による類似画像検出
- 重複スコアによる判定

### 4. 検索・発見性
**問題**: 大量の書籍から目的のものを探すのが困難
**解決**: 
- 全文検索対応
- 複数条件フィルタリング
- 著者、タグ、ジャンル等での絞り込み
- お気に入り機能

### 5. マルチデバイスアクセス
**問題**: PCでもスマートフォンでも快適に使いたい
**解決**: 
- レスポンシブWebアプリケーション
- デスクトップとモバイル両対応のUI
- ブラウザベースでどこからでもアクセス可能

### 6. ユーザー管理
**問題**: 複数ユーザーで利用したいが、個人のデータは分離したい
**解決**: 
- JWT認証によるセキュアなアクセス
- ユーザーごとの閲覧履歴・評価管理
- ライブラリ共有機能

## どのように動作すべきか

### ユーザーフロー

#### 1. 初回セットアップ
1. Docker Composeでアプリケーションを起動
2. 管理者アカウントで初回ログイン
3. ライブラリを作成

#### 2. 書籍のインポート
1. Zipファイルを監視フォルダ（book_send/）に配置
2. バックグラウンドワーカーが自動検出
3. 以下の処理を自動実行：
   - Zipファイルの解析
   - SHA1ハッシュの計算
   - サムネイルの生成
   - メタデータの抽出（ファイル名から）
   - ライブラリへの登録
4. 処理完了後、Webインターフェースから確認可能

#### 3. メタデータ編集
1. 書籍一覧から編集したい書籍を選択
2. タイトル、著者、タグ等を手動編集
3. 複数書籍の一括編集も可能

#### 4. 検索・閲覧
1. 検索バーで全文検索
2. フィルタで条件絞り込み（著者、タグ、ジャンル等）
3. 書籍をクリックして閲覧
4. 閲覧履歴と評価が自動記録

#### 5. 管理機能
1. 重複チェックの実行
2. エクスポート機能で書籍をバックアップ
3. タスクキューで処理状態を確認

### システムの振る舞い

#### バックグラウンド処理
- タスクキューシステムで非同期処理
- マルチプロセスで並列処理
- 処理状態をデータベースで管理
- エラー時は失敗フォルダ（book_fail/）に移動

#### キャッシュ戦略
- サムネイルはbook_cache/に保存
- リクエスト時に動的に高さを指定可能
- キャッシュ済みフラグで管理

#### 認証フロー
1. ユーザー名・パスワードでログイン
2. JWTトークンを取得
3. 以降のリクエストでトークンを使用
4. トークン有効期限切れで再ログイン

## ユーザーエクスペリエンス目標

### デスクトップ
- 大画面で書籍一覧を俯瞰
- 詳細なフィルタリングUIで素早く絞り込み
- サムネイルグリッド表示で視覚的に選択
- キーボードショートカット対応

### モバイル
- タッチ操作に最適化
- スワイプジェスチャー対応
- 縦スクロールで快適な一覧表示
- 最小限のタップで目的の書籍にアクセス

### 共通
- 直感的なUI（学習コスト最小）
- 高速なレスポンス（検索結果は1秒以内）
- エラー時の適切なフィードバック
- 処理中のプログレス表示

## 期待される使用パターン

### パターン1: 日常的な閲覧
頻度: 毎日〜週数回
- ログイン → 最近追加した書籍を確認 → 閲覧

### パターン2: 新規書籍の追加
頻度: 週1回〜月数回
- 書籍をダウンロード → 監視フォルダに配置 → インポート確認 → メタデータ編集

### パターン3: ライブラリ整理
頻度: 月1回〜数ヶ月に1回
- 重複チェック実行 → 重複削除 → タグ・著者の整理 → 評価の見直し

### パターン4: 特定書籍の検索
頻度: 随時
- 検索バーで検索 → フィルタで絞り込み → 閲覧

## 非機能要件

### パフォーマンス
- 書籍一覧の読み込み: 1秒以内
- 検索結果の表示: 1秒以内
- サムネイル表示: 2秒以内（キャッシュ済み）

### セキュリティ
- パスワードはbcryptでハッシュ化
- JWT認証でステートレス
- CORS設定で不正アクセス防止

### スケーラビリティ
- 数万冊の書籍管理に対応
- 同時接続ユーザー数: 数名〜数十名程度
- マルチプロセスワーカーで処理性能向上

### 保守性
- ログは日本語で統一
- データベースマイグレーション管理
- Docker Composeで環境の再現性確保
- 環境変数で設定を柔軟に変更

## 今後の展望

1. Vue 3（vue/）への完全移行（主要4ページ実装済み、残り機能移植＆本番切替）
2. より高度な検索機能（自然言語処理等）
3. レコメンデーション機能
4. ソーシャル機能（レビュー共有等）
5. 外部メタデータソースとの連携拡張
6. PWA対応検討
