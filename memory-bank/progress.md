# Progress

## 実装完了機能

### ✅ コア機能（バックエンド）

#### 1. 書籍管理システム
- [x] Zipファイルのインポート（監視フォルダ自動取り込み、SHA1/aHashハッシュ、サムネイル自動生成）
- [x] 書籍のエクスポート（Zipファイル書き出し）
- [x] 書籍の削除（ソフト削除 + 物理削除）
- [x] ライブラリ管理（作成・削除・共有）

#### 2. メタデータ管理
- [x] 書籍メタデータ（タイトル、著者、タグ、ジャンル、出版社、シリーズ）
- [x] マスタデータ管理（著者・タグ・ジャンル・出版社・シリーズ）
- [x] ユーザー固有データ（最終閲覧日、閲覧回数、開いているページ、評価）
- [x] 多対多・多対一リレーションシップ

#### 3. 検索・フィルタリング
- [x] 全文検索（タイトル、著者、タグ）
- [x] 複数条件フィルタリング
- [x] ソート機能（タイトル、追加日、ファイルサイズ）
- [x] ページネーション（limit/offset）

#### 4. 重複検出
- [x] SHA1ハッシュ完全一致検出
- [x] aHash類似画像検出
- [x] 重複スコア保存・管理

#### 5. 認証・認可
- [x] JWT認証 + OAuth2 Password Flow
- [x] bcryptパスワードハッシュ化
- [x] ユーザー管理 + スコープベース権限
- [x] 管理者アカウント自動作成

#### 6. バックグラウンドタスク処理
- [x] DBベースタスクキュー + マルチプロセスワーカー
- [x] インポート / エクスポート / 削除 / メタデータ修正 / 重複チェック / ルール適用 / キャッシュ生成

#### 7. メディア配信
- [x] Zipファイル・サムネイル画像配信
- [x] 動的サムネイルサイズ指定 + キャッシュ管理

### ✅ インフラ・デプロイ
- [x] Docker化（API, Web/Nginx, PostgreSQL, Worker）
- [x] Docker Compose構成 + ボリュームマウント + 環境変数管理
- [x] PostgreSQL 16 + SQLAlchemy 2.0 + Alembicマイグレーション
- [x] FastAPI 0.116 + Pydantic V2 + 自動APIドキュメント
- [x] CORS設定 + エラーハンドリング + 日本語ログ

### ✅ フロントエンド（Vue 2 — web/）
- [x] Vuetify 2ベースのレスポンシブUI
- [x] 書籍一覧・詳細表示、検索・フィルタUI
- [x] メタデータ編集、ユーザー設定管理
- [x] ログイン/ログアウト、タグ・著者管理
- [x] ダーク/ライトテーマ、モバイル対応

### ✅ フロントエンド（Vue 3 — vue/）主力

#### 基盤
- [x] Vue 3 + Vite + TypeScript プロジェクト構築
- [x] Vuetify 3統合（カスタムテーマ: primary `#082240`, success `#22663f`）
- [x] ファイルベースルーティング（unplugin-vue-router）
- [x] レイアウトシステム（vite-plugin-vue-layouts）
- [x] 自動インポート（Vue API, コンポーネント）
- [x] Pinia状態管理（userData, readerState, auth, app）
- [x] DevContainer開発環境（pnpm, Node.js）

#### API通信
- [x] Axiosクライアント（`func/axios.ts`）— 現在のメイン
- [x] openapi-fetchクライアント（`func/client.ts`）— 型安全、Bearer tokenミドルウェア
- [x] API型自動生成（`src/api.d.ts`）

#### ページ実装
- [x] **書籍一覧**（`index.vue`）: 検索テキストフィールド、ライブラリ選択、評価フィルタ、ページネーション、サムネイル/テーブル切替、ドロワーメニュー、リロード、ライブラリロード、重複リスト遷移
- [x] **書籍リーダー**（`books/[uuid].vue`）: ページ送り（単ページ/見開き）、先読みシステム（マルチロード、キャッシュページ数設定）、サイズ設定（カスタム高さ/画面サイズ）、評価更新、閲覧状態管理（open/pause/close）、設定のlocalStorage永続化、上部/下部サブメニュー
- [x] **ログイン**（`login.vue`）: JWT認証（フォームエンコード送信）、セットアップダイアログ、ローディング状態管理
- [x] **重複管理**（`duplicate.vue`）: 重複検出実行、重複グループ一覧、カバー画像表示、個別削除

#### ダイアログコンポーネント
- [x] SearchDialog: 高度な検索条件設定
- [x] BookDetailDialog: 書籍詳細・メタデータ編集
- [x] RangeChangeDialog: 一括変更操作
- [x] SetupDialog: 初回セットアップ

#### コンポーネント
- [x] BooksListTable: テーブル形式書籍一覧
- [x] BooksListThum: サムネイル形式書籍一覧
- [x] BaseAuthorChip: 著者チップ表示
- [x] AppFooter: フッター

#### Composables
- [x] `usePushNotice()`: トースト通知
- [x] `useGetCoverURL()`: カバー画像URL生成
- [x] `useConvertNumFormat()`: 日本語数値フォーマット
- [x] `useConvertDateFormat()`: 日付フォーマット
- [x] `useApiErrorHandler()`: APIエラーハンドリング
- [x] `useFitByte()`: バイトサイズ表示
- [x] フォームバリデーションルール

#### 認証フロー
- [x] Cookie（accessToken）によるセッション管理
- [x] App.vueマウント時のトークン検証
- [x] Axiosインターセプターでの401自動ログアウト
- [x] ルーターガードでの認証リダイレクト
- [x] バージョンチェック + 自動リロード

## 開発中・未完了機能

### 🚧 Vue 3（vue/）残作業

#### 機能完全移植
- [ ] ユーザー設定管理の詳細UI
- [ ] 管理者機能（ユーザー管理画面等）
- [ ] メタデータ一括編集の完全性
- [ ] 外部メタデータ連携UI
- [ ] ダーク/ライトテーマ切替

#### 技術的改善
- [ ] Axiosから openapi-fetch への段階的移行
- [ ] バージョン番号の動的取得（ハードコード解消）
- [ ] `authenticaitonSuccessful`/`authenticaitonFail` のタイポ修正
- [ ] 型安全性向上（any型の排除）
- [ ] エラーハンドリングの統一

#### 本番切り替え
- [ ] Docker イメージにVue 3ビルドを統合
- [ ] Nginx設定の更新
- [ ] E2Eテスト実施
- [ ] Vue 2（web/）からの完全切り替え

### 📋 計画中

#### テスト
- [x] API基本テスト（test_01_startup.py, test_02_library.py, test_10_scenario.py）
- [ ] APIテストカバレッジ向上
- [ ] Vue 3フロントエンドテスト（Vitest導入検討）
- [ ] E2Eテスト
- [ ] 継続的テスト自動化

#### CI/CD
- [ ] GitHub Actions設定
- [ ] 自動テスト・デプロイパイプライン
- [ ] コードカバレッジレポート

#### パフォーマンス・セキュリティ
- [ ] CORS設定の厳格化（本番環境）
- [ ] レート制限実装
- [ ] セキュリティヘッダー追加
- [ ] データベースクエリ最適化
- [ ] 大量データでのパフォーマンステスト

#### ドキュメント
- [x] メモリーバンク構築
- [x] CLAUDE.md（Claude Code向けガイド）
- [ ] ユーザーマニュアル
- [ ] 開発者ガイド
- [ ] デプロイガイド

## 既知の問題・制約

### 🐛 バグ・課題

| 優先度 | 内容 | 対応状況 |
|--------|------|----------|
| 高 | ファイル名が長すぎる場合のエラー（OSError: [Errno 36]） | 未対応（パス短縮アルゴリズム検討） |
| 中 | Vue 2サポート終了（2023年12月末） | vue/への移行で対応中 |
| 中 | 古いnpmパッケージ（web/内のaxios 0.21.4等） | vue/では最新版使用 |
| 低 | Worker処理のエラーリトライ機能 | 未実装 |
| 低 | タスクキューの優先度管理 | 未実装 |
| 低 | バージョン番号ハードコード（vue/内の`3.0.0`） | 検討中 |

### 🔒 技術的制約
- Zipファイル内の画像ファイルのみ対応（PDF、EPUB等は未対応）
- ファイルシステム制約（ファイル名長、パス長）
- 同時接続ユーザー数は数十名程度想定
- データベースは単一インスタンス

## マイルストーン

### 完了
- ✅ **v1.0**: 基本機能実装（2021-2022）
- ✅ **v2.0**: メタデータ管理強化（2022-2023）
- ✅ **v3.0**: API v3.0リリース、SQLAlchemy 2.0対応（2023-2025）

### 進行中
- 🚧 **v4.0候補**: Vue 3フロントエンド完成・本番切り替え
  - 主要4ページ実装完了
  - 残り: 管理者UI、完全機能移植、本番切り替え

### 予定
- 📋 **v4.1**: テスト強化・CI/CD
- 📋 **v4.2**: パフォーマンス・セキュリティ強化
- 📋 **v5.0**: 外部連携・レコメンデーション

## 最終更新日
2026-02-08: コードベース分析に基づく全面更新
