# Project Brief

## プロジェクト名
hinagiku-viewer

## プロジェクト概要
Zipファイルで管理された書籍（電子書籍・コミック等）を一元管理し、メタデータの表示、評価、検索、閲覧ができるWebアプリケーション。デスクトップとモバイルデバイスの両方に対応。

## 主要目標
1. Zipファイルで管理された書籍の効率的なライブラリ管理
2. メタデータの自動取得と手動編集機能
3. 高速な検索・フィルタリング機能
4. マルチユーザー対応と認証システム
5. レスポンシブなUI/UXでデスクトップ・モバイル両対応
6. Docker Composeによる簡単なデプロイ

## コア機能
### 1. 書籍管理
- Zipファイルのインポート（監視フォルダからの自動取り込み）
- ライブラリ単位での管理
- メタデータ管理（タイトル、著者、タグ、ジャンル、出版社、シリーズ等）
- ファイルハッシュ（SHA1/aHash）による重複チェック
- サムネイル自動生成・キャッシュ

### 2. メタデータ管理
- 著者、タグ、ジャンル、出版社、シリーズのマスタ管理
- 多対多リレーションシップ対応
- ユーザー固有データ（最終閲覧日、閲覧回数、評価等）

### 3. 検索・フィルタリング
- 全文検索対応
- 複数条件フィルタリング
- ソート機能

### 4. バックグラウンドタスク処理
- タスクキューシステム
- マルチプロセス対応
- 処理状態の管理
  - インポート処理
  - エクスポート処理
  - メタデータ自動修正
  - ハッシュ計算
  - 重複チェック
  - キャッシュ生成

### 5. 認証・ユーザー管理
- JWT認証
- OAuth2 Password Flow
- スコープベースの権限管理
- ライブラリの共有機能

## 技術スタック
- **バックエンド**: FastAPI (Python 3.11+)
- **フロントエンド**: 
  - **Vue 3 + Vite + Vuetify 3 (主力: vue/)** ← 現在の開発対象
  - Vue 2 + Vuetify 2 (レガシー本番: web/)
  - Vue 3 + Nuxt 3 (移行実験・非推奨: nuxt/)
- **データベース**: PostgreSQL 16
- **マイグレーション**: Alembic
- **コンテナ化**: Docker + Docker Compose

## アーキテクチャ原則
1. マイクロサービス構成（API、Worker、Web、DB）
2. RESTful API設計
3. データベースマイグレーション管理
4. 環境変数による設定管理
5. ログの日本語統一
6. 単一ポートでの公開（Nginxリバースプロキシ）

## プロジェクト構造
```
/workspaces/hinagiku-viewer/
├── api/          # FastAPI バックエンド
├── vue/          # Vue 3 + Vite フロントエンド（★主力）
├── web/          # Vue 2 フロントエンド（レガシー本番）
├── nuxt/         # Nuxt 3 フロントエンド（移行実験・非推奨）
├── data/         # データディレクトリ（ボリュームマウント）
├── memory-bank/  # プロジェクトドキュメント（Cline Memory Bank）
└── compose.yaml  # Docker Compose設定
```

## 制約事項
- ファイル名の長さ制限（OSの制約）
- Zipファイル内の画像ファイルのみ対応
- PostgreSQLへの依存
- Docker環境での実行を前提

## 成功基準
1. Zipファイルから自動的にメタデータを抽出できる
2. ユーザーが書籍を簡単に検索・閲覧できる
3. マルチユーザー環境で安定動作する
4. Docker Composeで簡単にデプロイできる
5. デスクトップ・モバイルで快適に動作する
