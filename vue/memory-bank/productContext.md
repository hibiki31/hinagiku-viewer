# Product Context - Vue 3 フロントエンド

## 重要: プロジェクト全体のプロダクト情報を参照

このファイルは `vue/` ディレクトリのVue 3フロントエンド固有のプロダクトコンテキストです。
**プロジェクト全体の情報は `/workspaces/hinagiku-viewer/memory-bank/productContext.md` を参照してください。**

プロジェクトルートのproductContextには以下が含まれます：
- プロジェクトの存在理由
- 解決する問題（書籍管理、メタデータ、重複検出、検索等）
- システム全体の動作フロー（インポート、メタデータ編集、検索・閲覧等）
- ユーザーエクスペリエンス目標
- 非機能要件
- 今後の展望

## Vue 3フロントエンドの役割

### フロントエンドの責務
1. **ユーザーインターフェース提供**: 書籍の閲覧・管理UI
2. **API通信**: バックエンドとのデータやり取り
3. **認証管理**: JWT認証フロー、Cookie管理
4. **状態管理**: ユーザーの閲覧状態、検索条件の保存
5. **ユーザー体験**: レスポンシブ、高速、直感的なUI

## 実装済みページのユーザーフロー

### 1. ログインページ（/login）
```
1. ユーザー名・パスワード入力
2. 「ログイン」ボタンクリック
   → POST /api/auth（フォームエンコード）
3. 成功 → Cookie保存 + / にリダイレクト
4. 失敗 → エラー通知表示
```

**初回セットアップ**:
- 管理者アカウントがない場合
- セットアップダイアログ自動表示
- アカウント作成 → 自動ログイン

### 2. 書籍一覧ページ（/）

```
1. ページロード
   → GET /api/books（検索条件・ページネーション付き）
2. 検索バーで検索
   → 検索条件をlocalStorageに保存
   → API再取得
3. フィルタ適用
   - ライブラリ選択
   - 評価フィルタ（☆1～5）
   → API再取得
4. 表示切替
   - サムネイル表示
   - テーブル表示
5. 書籍クリック
   → /books/:uuid にナビゲート
```

**ドロワーメニュー**:
- ライブラリ切替
- 重複管理へのリンク
- リロード機能

### 3. 書籍リーダーページ（/books/:uuid）

```
1. ページロード
   → GET /api/books/:uuid（メタデータ取得）
   → GET /api/media/:uuid/:page（画像取得）
2. 画像表示
   - 単ページ / 見開き切替
   - カスタム高さ指定
   - 画面サイズに合わせる
3. ページ送り
   - 左右矢印キー
   - スワイプジェスチャー（モバイル）
   - ページ番号クリック
4. 先読みシステム
   - 現在ページから指定ページ数先を自動ロード
   - 並列ロード数制限
5. 評価変更
   → PUT /api/books（評価更新）
6. 閲覧状態更新
   - ページ変更 → 現在ページをlocalStorageに保存
   - 閉じる → 閲覧状態を "close" に更新
```

**設定永続化**:
- 見開き設定
- 先読みページ数
- 並列ロード数
- 高さ設定
→ localStorage "readerSettings" に保存

### 4. 重複管理ページ（/duplicate）

```
1. ページロード
   → GET /api/duplication（重複グループ取得）
2. 「重複チェック実行」ボタン
   → POST /api/tasks/duplication（タスク登録）
   → 完了待機 → リロード
3. 重複グループ表示
   - カバー画像
   - タイトル
   - 重複スコア
4. 個別削除
   → DELETE /api/books/:uuid
   → リロード
```

## ダイアログのユーザーフロー

### SearchDialog（高度な検索）
```
1. 検索アイコンクリック
2. ダイアログ表示
3. 条件入力
   - 著者
   - タグ
   - ジャンル
   - 出版社
   - シリーズ
   - 評価
4. 「検索」ボタン
   → 親コンポーネントにemit
   → API再取得
```

### BookDetailDialog（書籍詳細・編集）
```
1. 書籍カードクリック
2. ダイアログ表示
3. メタデータ表示
   - タイトル
   - 著者
   - タグ
   - ジャンル
   - 出版社
   - シリーズ
4. 編集モード
   → 各フィールド編集
5. 「保存」ボタン
   → PUT /api/books（更新）
   → 通知表示
```

### RangeChangeDialog（一括変更）
```
1. 「一括変更」ボタンクリック
2. ダイアログ表示
3. 変更対象選択
   - 選択中の書籍
   - フィルタ結果全体
4. 変更内容指定
   - タグ追加/削除
   - 評価変更
   - ライブラリ移動
5. 「実行」ボタン
   → PATCH /api/books（一括更新）
   → 通知表示
```

## ユーザーエクスペリエンス目標（Vue 3固有）

### デスクトップ
- **書籍一覧**: グリッド表示で多数の書籍を俯瞰
- **検索**: リアルタイム検索、高度なフィルタ
- **リーダー**: 大画面で見開き表示、キーボードショートカット
- **スムーズな遷移**: ページ遷移時のローディング最小化

### モバイル
- **タッチ最適化**: スワイプジェスチャー、タップ操作
- **レスポンシブ**: 画面サイズに応じたレイアウト調整
- **縦スクロール**: 書籍一覧の快適な縦スクロール
- **高速表示**: 画像の遅延ロード、最適化

### 共通
- **直感的**: 学習コスト最小、明確なアイコン
- **高速**: API レスポンス1秒以内、画像キャッシュ活用
- **フィードバック**: 操作結果の明確な通知
- **エラーハンドリング**: わかりやすいエラーメッセージ

## Vue 3ならではの改善点

### Vue 2から改善された点
1. **型安全性**: TypeScriptフル活用、API型の自動生成
2. **開発効率**: 自動インポート、ファイルベースルーティング
3. **パフォーマンス**: Viteによる高速HMR、最適化されたビルド
4. **保守性**: Composition API、コードの再利用性向上
5. **モダンUI**: Vuetify 3の新コンポーネント、デザイン刷新

### Vue 2から引き継いだ機能
- 書籍一覧の基本機能（検索、フィルタ、ページネーション）
- 書籍リーダーの基本機能（ページ送り、先読み）
- 認証フロー（JWT + Cookie）
- メタデータ編集

### Vue 2から未移植の機能
- ユーザー設定管理の詳細UI
- 管理者機能（ユーザー管理等）
- テーマ切替（ダーク/ライトモード）
- 一部の高度なメタデータ編集機能

## 期待される使用パターン（フロントエンド視点）

### パターン1: 日常的な閲覧
```
1. / にアクセス（ログイン状態保持）
2. 最近追加された書籍を確認
3. 書籍クリック → /books/:uuid で閲覧
4. ページ送りで読み進める
5. 閉じる → 閲覧状態・ページ位置が自動保存
```

### パターン2: 検索から閲覧
```
1. / にアクセス
2. 検索バーでタイトル検索
3. フィルタで著者・タグを絞り込み
4. 評価フィルタで高評価のみ表示
5. 書籍クリック → 閲覧
```

### パターン3: 重複整理
```
1. / のドロワーから「重複管理」へ
2. 重複チェック実行
3. 重複グループ確認
4. 不要な書籍を削除
5. / に戻る
```

## パフォーマンス目標（フロントエンド視点）

### レスポンス時間
- **ページロード**: 初回2秒以内、2回目以降1秒以内
- **API通信**: レスポンス1秒以内
- **画像表示**: キャッシュ済み即座、未キャッシュ2秒以内
- **検索結果**: 1秒以内

### 先読みシステム
- **デフォルト**: 5ページ先まで先読み
- **並列ロード**: 3並列
- **調整可能**: ユーザーが設定で変更可能

## 最終更新日
2026-02-08: Vue 3メモリーバンク構造化
