# Progress - Vue 3 フロントエンド

## 重要: プロジェクト全体の進捗情報を参照

このファイルは `vue/` ディレクトリのVue 3フロントエンド固有の進捗状況です。
**プロジェクト全体の情報は `/workspaces/hinagiku-viewer/memory-bank/progress.md` を参照してください。**

プロジェクトルートのprogressには以下が含まれます：
- バックエンド機能の実装完了状況
- インフラ・デプロイ状況
- Vue 2フロントエンドの実装状況
- 開発中・未完了機能（プロジェクト全体）
- 既知の問題・制約
- マイルストーン

## 実装完了機能（Vue 3フロントエンド）

### ✅ 基盤構築
- [x] Vue 3 + Vite + TypeScript プロジェクト構築
- [x] Vuetify 3統合（カスタムテーマ設定）
- [x] ファイルベースルーティング（unplugin-vue-router）
- [x] レイアウトシステム（vite-plugin-vue-layouts）
- [x] 自動インポート（Vue API, コンポーネント）
- [x] 型定義ファイル生成（auto-imports.d.ts, components.d.ts, typed-router.d.ts）
- [x] DevContainer開発環境（pnpm, Node.js）
- [x] ESLint設定
- [x] .clinerules作成（Vue固有ルール）
- [x] memory-bank作成（Vue固有ドキュメント）
- [x] PWA対応（vite-plugin-pwa、Service Worker自動生成）
- [x] Docker本番環境対応（Dockerfile、nginx.conf）
- [x] バージョン番号のビルド時注入（package.json → import.meta.env）

### ✅ API通信
- [x] openapi-fetchクライアント（`func/client.ts`）に完全統一
  - [x] 型安全クライアント（`paths`型によるエンドポイント型推論）
  - [x] Bearerトークン認証ミドルウェア（Cookie読み取り）
  - [x] 401エラーハンドリングミドルウェア（自動ログアウト）
- [x] Axios完全排除（`func/axios.ts`削除、パッケージ削除済み）
- [x] API型自動生成（`src/api.d.ts`）

### ✅ 状態管理（Pinia）
- [x] **userData ストア**: 認証状態管理
  - [x] Cookie永続化
  - [x] ログイン/ログアウトアクション
  - [x] トークン検証
- [x] **readerState ストア**: 書籍一覧・リーダー状態
  - [x] localStorage永続化（searchQuery）
  - [x] 書籍検索アクション
  - [x] 表示モード切替
- [x] **auth ストア**: 認証設定
- [x] **app ストア**: アプリ全般の状態

### ✅ ページ実装

#### 1. 書籍一覧（`src/pages/index.vue`）
- [x] 検索テキストフィールド
- [x] ライブラリ選択ドロップダウン
- [x] 評価フィルタ（☆1～5）
- [x] ページネーション（前後ボタン + ページ番号入力）
- [x] サムネイル/テーブル表示切替
- [x] **ドロワーメニューUI改善**: 構造化・視認性向上
  - [x] ライブラリ一覧
  - [x] 重複管理リンク
  - [x] リロード機能
  - [x] バージョン表示
- [x] 書籍カードクリックで詳細ダイアログ
- [x] 書籍ダブルクリックでリーダーへ遷移
- [x] **ページタイトル動的設定**: 「書籍一覧」表示
- [x] **前回の続きを開く確認ダイアログ**: 誤操作防止

#### 2. 書籍リーダー（`src/pages/books/[uuid].vue`）
- [x] ページ送り（左右矢印、クリック）
- [x] 単ページ/見開き切替
- [x] **見開き自動判定機能**: 画像アスペクト比から自動判定
- [x] **マウス・タッチジェスチャー**: スワイプ/ドラッグでページ送り
- [x] 画像先読みシステム
  - [x] キャッシュページ数設定
  - [x] マルチロード（並列ロード数設定）
  - [x] Blob取得 + createObjectURL
- [x] サイズ設定
  - [x] カスタム高さ指定
  - [x] 画面サイズに合わせる
- [x] **設定メニューUI全面刷新**: 使いやすさ向上
- [x] 評価更新機能
- [x] 閲覧状態管理（open/pause/close）
- [x] 設定のlocalStorage永続化
- [x] 上部/下部サブメニュー
- [x] ページ位置の永続化
- [x] **ページタイトル動的設定**: 書籍名を表示

#### 3. ログイン（`src/pages/login.vue`）
- [x] ユーザー名・パスワード入力
- [x] JWT認証（POST /api/auth）
- [x] フォームエンコード送信
- [x] Cookie保存
- [x] セットアップダイアログ（初回起動時）
- [x] ローディング状態管理
- [x] エラーハンドリング
- [x] **ページタイトル動的設定**: 「ログイン」表示

#### 4. 重複管理（`src/pages/duplicate.vue`）
- [x] 重複グループ一覧表示
- [x] 重複チェック実行ボタン
- [x] カバー画像表示
- [x] 重複スコア表示
- [x] 個別削除機能
- [x] リロード機能
- [x] **ページタイトル動的設定**: 「重複管理」表示

### ✅ ダイアログコンポーネント
- [x] **SearchDialog**: 高度な検索条件設定
  - [x] 著者、タグ、ジャンル、出版社、シリーズ選択
  - [x] 評価フィルタ
  - [x] 検索実行
- [x] **BookDetailDialog**: 書籍詳細・メタデータ編集
  - [x] メタデータ表示
  - [x] 編集モード
  - [x] 保存機能
- [x] **RangeChangeDialog**: 一括変更操作
  - [x] 対象選択（選択中/フィルタ結果全体）
  - [x] 変更内容指定
  - [x] 一括更新
- [x] **SetupDialog**: 初回セットアップ
  - [x] 管理者アカウント作成
  - [x] 自動ログイン

### ✅ 再利用可能コンポーネント
- [x] **BooksListTable**: テーブル形式書籍一覧
- [x] **BooksListThum**: サムネイル形式書籍一覧
- [x] **BaseAuthorChip**: 著者チップ表示
- [x] **AppFooter**: フッター

### ✅ Composables
- [x] **usePushNotice()**: トースト通知
- [x] **useGetCoverURL()**: カバー画像URL生成
- [x] **useConvertNumFormat()**: 日本語数値フォーマット
- [x] **useConvertDateFormat()**: 日付フォーマット
- [x] **useApiErrorHandler()**: APIエラーハンドリング
- [x] **useFitByte()**: バイトサイズ表示
- [x] **useSetTitle()**: ページタイトル動的設定
- [x] **useGesture()**: マウス・タッチジェスチャー認識
- [x] フォームバリデーションルール

### ✅ 認証フロー
- [x] App.vueマウント時のトークン検証
- [x] Cookie（accessToken）によるセッション管理
- [x] Axiosインターセプターでの401自動ログアウト
- [x] ルーターガードでの認証リダイレクト
- [x] バージョンチェック + 自動リロード

## 開発中・未完了機能（Vue 3フロントエンド）

### 🚧 未実装ページ
- [ ] ユーザー設定管理ページ
- [ ] 管理者機能ページ（ユーザー管理等）
- [ ] タグ管理ページ
- [ ] 著者管理ページ
- [ ] ライブラリ管理ページ

### 🚧 未実装機能
- [ ] ダーク/ライトテーマ切替
- [ ] 外部メタデータ連携UI
- [ ] エクスポート機能UI
- [ ] タスクキュー状態表示UI
- [ ] 詳細な統計情報表示

### 🚧 技術的改善
- [x] Axiosからopenapi-fetchへの完全移行（2026-02-08完了）
- [x] バージョン番号の動的取得（ビルド時注入、2026-02-08完了）
- [x] 環境変数の統一（VITE_APP_API_HOSTに統一、2026-02-08完了）
- [x] ビルド警告の解消（動的インポート警告の修正、2026-02-09完了）
- [ ] `authenticaitonSuccessful`/`authenticaitonFail` のタイポ修正
- [ ] 型安全性向上（any型の排除）
- [ ] エラーハンドリングの統一
- [ ] ローディング状態の統一管理

### 🚧 テスト
- [ ] Vitest導入
- [ ] ユニットテスト作成
- [ ] コンポーネントテスト作成
- [ ] E2Eテスト作成

### 🚧 本番切り替え
- [x] Dockerイメージへの統合（2026-02-08完了）
- [x] Nginx設定の更新（2026-02-08完了）
- [x] PWA対応（2026-02-09完了）
- [ ] 本番環境でのテスト
- [ ] Vue 2（web/）からの完全切り替え

## 既知の問題・制約（Vue 3固有）

### 🐛 バグ・課題

| 優先度 | 内容 | 対応状況 |
|--------|------|----------|
| ~~低~~ | ~~バージョン番号ハードコード~~ | ✅ 解決済み（ビルド時注入、2026-02-08） |
| 低 | `authenticaitonSuccessful`/`authenticaitonFail` タイポ | 既存コード全体で使用中、リファクタ時に修正 |
| ~~低~~ | ~~Axiosとopenapi-fetchの混在~~ | ✅ 解決済み（2026-02-08） |
| ~~中~~ | ~~Docker本番環境未対応~~ | ✅ 解決済み（2026-02-08） |
| ~~中~~ | ~~PWA未対応~~ | ✅ 解決済み（2026-02-09） |

### 🔒 技術的制約
- バックエンドAPI（FastAPI）への依存
- `src/api.d.ts` の型定義の手動生成が必要
- テストカバレッジなし

## マイルストーン（Vue 3固有）

### 完了
- ✅ **基盤構築** (2024-2025): Vue 3 + Vite + TypeScript環境構築
- ✅ **主要4ページ実装** (2025-2026): index, books/[uuid], login, duplicate
- ✅ **API統一** (2026-02-08): openapi-fetchへの完全移行
- ✅ **Docker本番対応** (2026-02-08): マルチステージビルド、Nginx設定
- ✅ **PWA対応** (2026-02-09): オフライン機能、Service Worker

### 進行中
- 🚧 **機能移植**: Vue 2から残り管理機能の移植
- 🚧 **技術的改善**: 型安全性向上、エラーハンドリング統一

### 予定
- 📋 **テスト整備**: Vitest + E2Eテスト
- 📋 **本番切り替え**: 本番環境での最終テスト、Vue 2からの完全移行
- 📋 **機能拡張**: テーマ切替、統計情報等

## 現在の完成度

### 総合評価
主要4ページ実装完了により、コア機能は動作可能。残りは管理機能UIと本番環境への統合。

### ページ別完成度
| ページ | 完成度 | 備考 |
|--------|--------|------|
| 書籍一覧 | 95% | UI改善完了、高度な一括編集が未実装 |
| 書籍リーダー | 98% | ジェスチャー・見開き自動判定完了 |
| ログイン | 100% | 完成 |
| 重複管理 | 85% | 基本機能完了、詳細比較UI未実装 |
| ユーザー設定 | 0% | 未着手 |
| 管理者機能 | 0% | 未着手 |

### 技術基盤完成度
| カテゴリ | 完成度 | 備考 |
|---------|--------|------|
| 開発環境 | 100% | DevContainer完備 |
| ビルドシステム | 100% | Vite設定完了 |
| 状態管理 | 90% | 主要ストア完備 |
| API通信 | 100% | openapi-fetch統一完了 |
| 型安全性 | 80% | 型定義完備、一部anyが残存 |
| PWA対応 | 100% | Service Worker、オフライン対応完了 |
| Docker本番環境 | 100% | Dockerfile、Nginx設定完了 |
| テスト | 0% | 未着手 |
| ドキュメント | 100% | memory-bank完備 |

## 次のアクション（優先順位順）

### 高優先度
1. 本番環境での最終テスト
2. Vue 2からの完全切り替え

### 中優先度
3. 残り管理機能ページの実装
4. テーマ切替機能の実装
5. エラーハンドリングの統一
6. テスト環境の構築

### 低優先度
7. バージョン番号の動的取得
8. タイポ修正
9. パフォーマンス最適化

## 最終更新日
2026-02-09: PWA対応完了、Docker本番環境統合完了
